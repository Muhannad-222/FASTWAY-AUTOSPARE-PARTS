<!doctype html>
<html lang="en">
<head>
Â  Â  <meta charset="utf-8" />
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  Â  <title>FastWay Inventory: Email/Password Auth Edition</title>
Â  Â  Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <style>
Â  Â  Â  Â  /* --- Option 2: Soft Clay/Neumorphism Aesthetic --- */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  /* Palette: Soft Light Background, Light Shadows, Vibrant Accents */
Â  Â  Â  Â  Â  Â  --bg-primary: #E0E0E0; /* Soft Clay Background */
Â  Â  Â  Â  Â  Â  --accent-yellow: #FFC000; /* Glowing Yellow */
Â  Â  Â  Â  Â  Â  --accent-orange: #FF6A00; /* Glowing Orange */
Â  Â  Â  Â  Â  Â  --text-dark: #374151; /* Dark Text */
Â  Â  Â  Â  Â  Â  --text-subtle: #9CA3AF;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* Neumorphism Base Shadows */
Â  Â  Â  Â  Â  Â  --shadow-light: #ffffff; /* Lighter shadow for top/left */
Â  Â  Â  Â  Â  Â  --shadow-dark: #b0b0b0; /* Darker shadow for bottom/right */
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* Elevation Mixin */
Â  Â  Â  Â  Â  Â  --neumo-elevated: 8px 8px 16px var(--shadow-dark), -8px -8px 16px var(--shadow-light);
Â  Â  Â  Â  Â  Â  --neumo-pressed: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
Â  Â  Â  Â  }

Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  background-color: var(--bg-primary);Â 
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  color: var(--text-dark);
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Neumorphism Base Styles --- */
Â  Â  Â  Â  .neumo-panel {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-primary);
Â  Â  Â  Â  Â  Â  border-radius: 2.5rem; /* Larger, softer corners for panels */
Â  Â  Â  Â  Â  Â  box-shadow: var(--neumo-elevated); /* Soft, elevated look */
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease-in-out;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* High-Contrast/Extruded Buttons */
Â  Â  Â  Â  .neumo-btn {
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease-in-out;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  border-radius: 9999px; /* Pill shape */
Â  Â  Â  Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  letter-spacing: 0.01em;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* Inherit base background and apply elevation */
Â  Â  Â  Â  Â  Â  background-color: var(--bg-primary);Â 
Â  Â  Â  Â  Â  Â  box-shadow: var(--neumo-elevated);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .neumo-btn:hover {
Â  Â  Â  Â  Â  Â  opacity: 0.95;
Â  Â  Â  Â  Â  Â  box-shadow: 4px 4px 10px var(--shadow-dark), -4px -4px 10px var(--shadow-light);
Â  Â  Â  Â  Â  Â  transform: translateY(-1px);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Pressed state (for user feedback) */
Â  Â  Â  Â  .neumo-btn:active {
Â  Â  Â  Â  Â  Â  box-shadow: var(--neumo-pressed);
Â  Â  Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  }

Â  Â  Â  Â  .neumo-btn-primary {Â 
Â  Â  Â  Â  Â  Â  /* Primary accent button, color overrides neumo look */
Â  Â  Â  Â  Â  Â  background: linear-gradient(145deg, var(--accent-yellow), var(--accent-orange));Â 
Â  Â  Â  Â  Â  Â  color: var(--text-dark);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2), -4px -4px 10px rgba(255, 255, 255, 0.5); /* Stronger button shadow */
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Secondary buttons get the soft clay look */
Â  Â  Â  Â  .neumo-btn-secondary {Â 
Â  Â  Â  Â  Â  Â  color: var(--text-dark);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Status Pill Style (Keep some vibrance) */
Â  Â  Â  Â  .status-pill {
Â  Â  Â  Â  Â  Â  background: linear-gradient(145deg, var(--accent-yellow), var(--accent-orange));
Â  Â  Â  Â  Â  Â  color: var(--text-dark);
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  padding: 0.5rem 1.5rem;
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Inventory Card (Layered Neumorphism) */
Â  Â  Â  Â  .part-card {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-primary);
Â  Â  Â  Â  Â  Â  border-radius: 2rem;
Â  Â  Â  Â  Â  Â  /* Inset shadow for a "pressed" card look */
Â  Â  Â  Â  Â  Â  box-shadow: inset 5px 5px 10px var(--shadow-dark), inset -5px -5px 10px var(--shadow-light);Â 
Â  Â  Â  Â  Â  Â  padding: 2rem;
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  Â  Â  Â  gap: 1.5rem;
Â  Â  Â  Â  Â  Â  color: var(--text-dark);
Â  Â  Â  Â  Â  Â  border: none; /* Remove border from old style */
Â  Â  Â  Â  }

Â  Â  Â  Â  @media (min-width: 768px) {
Â  Â  Â  Â  Â  Â  .part-card {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 2.5fr;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  .card-header-container {
Â  Â  Â  Â  Â  Â  Â  Â  border-right: 1px solid var(--shadow-dark); /* Subtle separation line */
Â  Â  Â  Â  Â  Â  Â  Â  padding-right: 2rem;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .card-zoren-no {
Â  Â  Â  Â  Â  Â  font-size: 2.5rem;
Â  Â  Â  Â  Â  Â  font-weight: 900;
Â  Â  Â  Â  Â  Â  color: var(--accent-orange);
Â  Â  Â  Â  Â  Â  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); /* Soft shadow for contrast */
Â  Â  Â  Â  Â  Â  line-height: 1;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .oem-tag {
Â  Â  Â  Â  Â  Â  background: #D1D5DB; /* Tailwind Gray-300 - better contrast */
Â  Â  Â  Â  Â  Â  color: var(--text-dark);
Â  Â  Â  Â  Â  Â  padding: 0.3rem 1rem;
Â  Â  Â  Â  Â  Â  border-radius: 9999px;
Â  Â  Â  Â  Â  Â  font-size: 0.875rem;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  margin-right: 0.5rem;
Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;
Â  Â  Â  Â  Â  Â  box-shadow: inset 1px 1px 3px var(--shadow-dark), inset -1px -1px 3px var(--shadow-light);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Styling for ALL inputs and selects */
Â  Â  Â  Â  input, select, textarea {
Â  Â  Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  Â  Â  border-radius: 1.5rem; /* Match panel curvature */
Â  Â  Â  Â  Â  Â  padding: 0.9rem 1.75rem;Â 
Â  Â  Â  Â  Â  Â  background-color: var(--bg-primary);Â 
Â  Â  Â  Â  Â  Â  color: var(--text-dark);
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  transition: all 0.2s;
Â  Â  Â  Â  Â  Â  /* Inset Shadow for Pressed Input */
Â  Â  Â  Â  Â  Â  box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Custom Styling for Modal Inputs (to make them look thicker/more substantial) */
Â  Â  Â  Â  #modalAddEdit input,Â 
Â  Â  Â  Â  #modalAddEdit select,Â 
Â  Â  Â  Â  #modalAddEdit textarea,
Â  Â  Â  Â  #modalAuth input {
Â  Â  Â  Â  Â  Â  padding: 1rem 2rem; /* Increased padding */
Â  Â  Â  Â  Â  Â  font-size: 1.125rem; /* Larger font size */
Â  Â  Â  Â  Â  Â  font-weight: 600; /* Bolder text */
Â  Â  Â  Â  }

Â  Â  Â  Â  input::placeholder, textarea::placeholder {
Â  Â  Â  Â  Â  Â  color: var(--text-subtle);
Â  Â  Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  }

Â  Â  Â  Â  input:focus, select:focus, textarea:focus {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-primary);
Â  Â  Â  Â  Â  Â  box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light), 0 0 0 2px var(--accent-yellow); /* Focus ring */
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Dedicated style for primary control inputs (Search/Filter) */
Â  Â  Â  Â  .neumo-control-input {
Â  Â  Â  Â  Â  Â  font-size: 1.125rem; /* Same larger font for consistency */
Â  Â  Â  Â  Â  Â  padding: 1rem 2rem; /* Substantial padding */
Â  Â  Â  Â  Â  Â  border-radius: 2rem; /* Softer edges */
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Modal: Retain Neumorphism on modal for consistency */
Â  Â  Â  Â  .modal-neumo {Â 
Â  Â  Â  Â  Â  Â  background-color: var(--bg-primary);Â 
Â  Â  Â  Â  Â  Â  border: 1px solid var(--shadow-light);
Â  Â  Â  Â  Â  Â  border-radius: 2rem;
Â  Â  Â  Â  Â  Â  box-shadow: var(--neumo-elevated);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Error Alert (Contrasting) */
Â  Â  Â  Â  .system-error {
Â  Â  Â  Â  Â  Â  background-color: #FEE2E2; /* Red-100 */
Â  Â  Â  Â  Â  Â  color: #DC2626; /* Red-600 */
Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  Â  Â  Â  padding: 0.5rem 1rem;
Â  Â  Â  Â  Â  Â  font-size: 0.875rem;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  Â  Â  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Specific adjustments for dark text on light background */
Â  Â  Â  Â  .text-light-override {
Â  Â  Â  Â  Â  Â  color: var(--text-dark) !important;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Search Highlight Style --- */
Â  Â  Â  Â  .highlight {
Â  Â  Â  Â  Â  Â  background-color: #FACC15; /* Tailwind yellow-400 for high contrast */
Â  Â  Â  Â  Â  Â  color: black;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  padding: 1px 3px;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  }

Â  Â  </style>
</head>
<body class="min-h-screen text-gray-800 p-4 md:p-6">

<div class="max-w-7xl mx-auto">
Â  Â  <header class="mb-10 flex flex-col md:flex-row justify-between items-start md:items-center p-6 rounded-2xl">
Â  Â  Â  Â  <div class="mb-4 md:mb-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="text-5xl font-extrabold text-gray-800 leading-tight">FASTWAY AUTO SPAREPARTS</h1>
Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold text-gray-600 mt-1">INVENTORY CATALOG</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="flex flex-col items-end">
Â  Â  Â  Â  Â  Â  <p id="authStatus" class="status-pill">AUTHENTICATING...</p>
Â  Â  Â  Â  Â  Â  <p id="connectionLog" class="text-xs mt-1 text-gray-500">Starting initialization...</p>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="loggedOutButtons" class="flex gap-2 mt-3 hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnOpenSignIn" class="neumo-btn neumo-btn-secondary px-5 py-2 text-sm">Sign In</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnOpenSignUp" class="neumo-btn neumo-btn-primary px-5 py-2 text-sm">Sign Up</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="loggedInButtons" class="flex gap-2 mt-3 hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnManageCategories" class="neumo-btn neumo-btn-secondary px-5 py-2 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Manage Categories
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnLogout" class="neumo-btn neumo-btn-secondary bg-gray-400 text-light-override px-5 py-2 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Logout
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <div id="rulesInstruction" class="hidden neumo-panel p-6 border-red-500 border-2">
Â  Â  Â  Â  <p class="font-extrabold text-xl mb-2 text-red-600">ðŸ”´ CRITICAL ERROR: PERMISSION DENIED ðŸ”´</p>
Â  Â  Â  Â  <p class="text-gray-700">Your application is authenticated, but the Firestore Security Rules are preventing it from reading data.</p>
Â  Â  Â  Â  <p class="mt-2 text-gray-700">To fix this, go to the Firebase Console > Firestore Database > Rules, and replace the existing rules with the code below.</p>
Â  Â  Â  Â  <pre id="rulesCode" class="bg-gray-200 text-yellow-700 p-4 rounded-lg mt-3 overflow-x-auto text-sm"></pre>
Â  Â  </div>

Â  Â  <section id="appContent" class="hidden">
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <section class="mb-10 p-4 md:p-6 neumo-panel flex flex-col md:flex-row flex-wrap gap-4 items-center"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â style="box-shadow: var(--neumo-pressed); padding: 1.5rem; border-radius: 2rem;">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap gap-4 w-full md:w-auto md:min-w-[200px]">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnAdd" class="neumo-btn neumo-btn-primary text-lg flex-grow">+ NEW PART</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnBulk" class="neumo-btn neumo-btn-secondary text-lg flex-grow">BULK JSON</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow flex flex-col md:flex-row items-center gap-4 w-full md:w-auto p-3 rounded-2xl bg-gray-300 bg-opacity-30">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="categoryFilter" class="neumo-control-input flex-grow w-full md:w-60"></select>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="searchInput" type="search" placeholder="SEARCH (ZOREN, OEM, MAKER, APP)" class="neumo-control-input flex-grow w-full md:flex-grow" />
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="perPage" class="w-full md:w-32 neumo-control-input">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="10">10 / Page</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="25">25 / Page</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="50">50 / Page</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="100">100 / Page</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="200">200 / Page</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap gap-3 w-full md:w-auto md:justify-end">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnDownloadJson" class="neumo-btn neumo-btn-secondary bg-gray-400 text-light-override px-4 py-3 flex-grow md:flex-none">Export JSON</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnExportCsv" class="neumo-btn neumo-btn-secondary bg-green-500 text-light-override px-4 py-3 flex-grow md:flex-none">Export CSV</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section>
Â  Â  Â  Â  Â  Â  <div id="partsContainer" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mt-10 neumo-panel p-4 flex flex-wrap gap-4 items-center justify-between text-gray-800">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-base font-semibold" id="summaryText">0 RECORDS LOADED</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="prevPage" class="neumo-btn neumo-btn-secondary px-5 py-2">PREVIOUS</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="pageInfo" class="px-3 text-lg font-extrabold"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="nextPage" class="neumo-btn neumo-btn-secondary px-5 py-2">NEXT</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>
Â  Â  </section>
</div>

<div id="modalConfirm" class="hidden fixed inset-0 z-40 flex items-center justify-center">
Â  Â  <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
Â  Â  <div class="modal-neumo z-50 w-full max-w-sm p-6 text-gray-800 border-yellow-700 border-t-2">
Â  Â  Â  Â  <h3 id="confirmTitle" class="text-2xl font-bold mb-4">CONFIRM ACTION</h3>
Â  Â  Â  Â  <p id="confirmMessage" class="text-gray-600 mb-6"></p>
Â  Â  Â  Â  <div class="flex justify-end gap-3">
Â  Â  Â  Â  Â  Â  <button id="btnConfirmCancel" class="neumo-btn neumo-btn-secondary px-5 py-2">CANCEL</button>
Â  Â  Â  Â  Â  Â  <button id="btnConfirmAction" class="neumo-btn neumo-btn-primary px-5 py-2 bg-red-600 text-light-override">CONFIRM</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<div id="modalAddEdit" class="hidden fixed inset-0 z-40 flex items-center justify-center">
Â  Â  <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
Â  Â  Â  Â  <div class="modal-neumo z-50 w-full max-w-3xl p-8 text-gray-800 border-yellow-700 border-t-4">
Â  Â  Â  Â  <h3 id="modalTitle" class="text-3xl font-extrabold mb-6">ADD/EDIT PART</h3>
Â  Â  Â  Â  <div class="space-y-5">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-600">Category <span class="text-red-600">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="inpCategory" class="w-full"></select>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="categoryError" class="text-xs text-red-600 mt-1 hidden system-error">Category is required.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-600">ZOREN No. <span class="text-red-600">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="inpZoren" class="w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  <p id="zorenError" class="mt-2 hidden system-error">ZOREN No. is required (min 4 chars) and must be alphanumeric/hyphen.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-600">Car Maker <span class="text-red-600">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="inpCarMaker" class="w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  <p id="carMakerError" class="mt-2 hidden system-error">Car Maker is required.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-600">Applications <span class="text-red-600">*</span></label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="inpApplications" class="w-full" />
Â  Â  Â  Â  Â  Â  Â  Â  <p id="applicationsError" class="mt-2 hidden system-error">Applications field is required.</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-600">OEM No. (comma separated)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="inpOem" class="w-full" placeholder="31110-09000, E8678M" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="mt-10 flex justify-end gap-3">
Â  Â  Â  Â  Â  Â  <button id="btnCancelModal" class="neumo-btn neumo-btn-secondary px-6 py-2.5">CANCEL</button>
Â  Â  Â  Â  Â  Â  <button id="btnSaveModal" class="neumo-btn neumo-btn-primary px-6 py-2.5">SAVE PART</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
</div>

<div id="modalBulk" class="hidden fixed inset-0 z-40 flex items-center justify-center">
Â  Â  <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
Â  Â  <div class="modal-neumo z-50 w-full max-w-3xl p-8 text-gray-800 border-orange-600 border-t-4">
Â  Â  Â  Â  <h3 class="text-3xl font-extrabold mb-6">BULK JSON UPLOAD</h3>
Â  Â  Â  Â  <p class="text-sm text-gray-600 mb-4">Paste JSON array or upload a .json file. Data is validated on upload.</p>

Â  Â  Â  Â  <div class="space-y-5">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium mb-1 text-gray-600">Paste JSON array</label>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="bulkTextarea" rows="8" class="w-full font-mono shadow-inner border-gray-400 bg-gray-200 bg-opacity-50" placeholder='[{"zoren":"ZRM...","oem":["..."],"car_maker":"...","applications":"..."}]'></textarea>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="bulkCategorySelector" class="flex flex-col gap-2 p-5 neumo-panel border-yellow-700 border-t-2">
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-base font-bold">Category Assignment for uncategorized imports:</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="bulkCategoryInput" class=""></select>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="mt-8 flex flex-wrap items-center gap-4">
Â  Â  Â  Â  Â  Â  <input id="bulkFileInput" type="file" accept=".json,application/json" class="text-sm font-semibold text-gray-800" />
Â  Â  Â  Â  Â  Â  <button id="btnLoadBulk" class="neumo-btn neumo-btn-secondary bg-gray-400 text-light-override px-5 py-2.5">Load & Merge</button>
Â  Â  Â  Â  Â  Â  <button id="btnReplaceBulk" class="neumo-btn neumo-btn-primary px-5 py-2.5 bg-red-600 text-light-override">REPLACE ALL INVENTORY</button>
Â  Â  Â  Â  Â  Â  <button id="btnCloseBulk" class="ml-auto neumo-btn neumo-btn-secondary px-5 py-2.5">CLOSE</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
</div>

<div id="modalCategoryManager" class="hidden fixed inset-0 z-40 flex items-center justify-center">
Â  Â  <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
Â  Â  <div class="modal-neumo z-50 w-full max-w-md p-8 text-gray-800 border-gray-600 border-t-4">
Â  Â  Â  Â  <h3 class="text-3xl font-extrabold mb-6">CATEGORY MANAGER</h3>
Â  Â  Â  Â  <div class="space-y-5">
Â  Â  Â  Â  Â  Â  <div class="flex gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <input id="inpNewCategory" class="w-full" placeholder="e.g., Brake System" />
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnAddCategory" class="neumo-btn neumo-btn-primary bg-green-600 text-light-override px-5 py-2">ADD</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="categoryListContainer" class="max-h-64 overflow-y-auto border border-gray-400 rounded-xl p-4 space-y-3 neumo-panel" style="box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light);">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="mt-8 flex justify-end">
Â  Â  Â  Â  Â  Â  <button id="btnCloseCategoryManager" class="neumo-btn neumo-btn-primary px-6 py-2.5">DONE</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>


<div id="modalAuth" class="hidden fixed inset-0 z-40 flex items-center justify-center">
Â  Â  <div class="modal-backdrop absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
Â  Â  <div class="modal-neumo z-50 w-full max-w-md p-8 text-gray-800 border-yellow-700 border-t-4">
Â  Â  Â  Â  <h3 id="authModalTitle" class="text-3xl font-extrabold mb-6">Sign In</h3>
Â  Â  Â  Â  <p id="authError" class="mt-2 hidden system-error"></p>
Â  Â  Â  Â  <div class="space-y-5 mt-5">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-600">Email</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="authEmail" type="email" class="w-full" placeholder="you@company.com" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <label class="block text-sm font-medium text-gray-600">Password</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input id="authPassword" type="password" class="w-full" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="mt-8 flex justify-between items-center">
Â  Â  Â  Â  Â  Â  <button id="btnToggleAuthMode" class="text-sm font-semibold text-gray-600 hover:text-gray-800">Need an account? Sign Up</button>
Â  Â  Â  Â  Â  Â  <div class="flex gap-3">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnCloseAuthModal" class="neumo-btn neumo-btn-secondary px-6 py-2.5">CANCEL</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="btnAuthAction" class="neumo-btn neumo-btn-primary px-6 py-2.5">SIGN IN</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>


<script type="module">
Â  Â  // --- FIREBASE IMPORTS (Modern Modular SDK v11.6.1) ---
Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  // UPDATED: Added new Auth methods for Email/Password
Â  Â  import { 
Â  Â  Â  Â  getAuth, 
Â  Â  Â  Â  onAuthStateChanged, 
Â  Â  Â  Â  createUserWithEmailAndPassword,Â 
Â  Â  Â  Â  signInWithEmailAndPassword,Â 
Â  Â  Â  Â  signOut
Â  Â  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  import { getFirestore, doc, setDoc, addDoc, onSnapshot, collection, getDoc, getDocs, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  // --- GLOBAL VARIABLES & INITIALIZATION ---
Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
Â  Â Â 
Â  Â  // User's explicit Firebase configurationÂ 
Â  Â  const userFirebaseConfig = {
Â  Â  Â  Â  apiKey: "AIzaSyDMG67OjTem-qRC8S8NN58weeeHnZIGLW0",
Â  Â  Â  Â  authDomain: "fastway-autospare-parts-shibi.firebaseapp.com",
Â  Â  Â  Â  projectId: "fastway-autospare-parts-shibi",
Â  Â  Â  Â  storageBucket: "fastway-autospare-parts-shibi.firebasestorage.app",
Â  Â  Â  Â  messagingSenderId: "129701229596",
Â  Â  Â  Â  appId: "1:129701229596:web:ff12c4d0ed2c87ee2d9bd9",
Â  Â  Â  Â  measurementId: "G-JV6NF5FREJ"
Â  Â  };

Â  Â  // Use environment config if available, otherwise use user's explicit config
Â  Â  const envConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
Â  Â  const firebaseConfig = Object.keys(envConfig).length > 0 ? envConfig : userFirebaseConfig;

Â  Â  // REMOVED: initialAuthToken is no longer used for email/password auth


Â  Â  // 2. Initialize Firebase App and Services
Â  Â  let app, auth, db;
Â  Â Â 
Â  Â  // Status update helper
Â  Â  function updateConnectionStatus(message, isError = false) {
Â  Â  Â  Â  const logEl = getEl('connectionLog');
Â  Â  Â  Â  if (logEl) {
Â  Â  Â  Â  Â  Â  logEl.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
Â  Â  Â  Â  Â  Â  logEl.style.color = isError ? '#DC2626' : '#6B7280'; // Red or Gray-500
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- Utility to safely get elements ---
Â  Â  function getEl(id) {
Â  Â  Â  Â  return document.getElementById(id);
Â  Â  }
Â  Â Â 
Â  Â  // --- Security Rules Handler ---
Â  Â  function displaySecurityRulesError(errorMessage) {
Â  Â  Â  Â  const rulesInstruction = getEl('rulesInstruction');
Â  Â  Â  Â  const rulesCode = getEl('rulesCode');

Â  Â  Â  Â  rulesInstruction.classList.remove('hidden');
Â  Â  Â  Â  getEl('appContent').classList.add('hidden'); // Hide the main content until fixed
Â  Â  Â  Â  getEl('partsContainer').innerHTML = `<p class="text-center text-red-600 p-8 text-xl font-bold">Error: ${errorMessage}. See instructions above.</p>`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // UPDATED RULES for /users/{userId}
Â  Â  Â  Â  rulesCode.textContent = `
rules_version = '2';
service cloud.firestore {
Â  match /databases/{database}/documents {
Â  Â  // This function checks if the user is authenticated
Â  Â  function isAuthenticated() {
Â  Â  Â  return request.auth != null;
Â  Â  }

Â  Â  // IMPORTANT: The new path stores data privately under the authenticated user's ID.
Â  Â  // The rule ensures a user can ONLY read/write documents located directly under their UID.
Â  Â  match /users/{userId}/{documents=**} {
Â  Â  Â  allow read, write: if isAuthenticated() && request.auth.uid == userId;
Â  Â  }

Â  Â  // DENY access to the old 'public_parts' if it exists.
Â  Â  match /public_parts/{document=**} {
Â  Â  Â  allow read, write: if false;
Â  Â  }
Â  }
}
`;
Â  Â  }


Â  Â  // --- Core Initialization Function ---
Â  Â  async function initApp() {
Â  Â  Â  Â  updateConnectionStatus("Attempting Firebase initialization...");
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  auth = getAuth(app);
Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  updateConnectionStatus("Services initialized. Starting authentication check...");
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Set up listener for auth state changes
Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, async (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = user;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Display email if available, otherwise use a generic 'Authenticated'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const display = user.email ? user.email : `UID: ${user.uid.substring(0, 8)}...`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getEl('authStatus').textContent = `${display} (Authenticated)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Show/Hide UI elements
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getEl('appContent').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getEl('loggedInButtons').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getEl('loggedOutButtons').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateConnectionStatus("Authentication successful. Loading inventory...");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Must be called AFTER currentUser is set
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await loadCategories();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadAndRenderParts(); // Start listening to parts data
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getEl('authStatus').textContent = `LOGGED OUT`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Show/Hide UI elements
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getEl('appContent').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getEl('loggedInButtons').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  getEl('loggedOutButtons').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateConnectionStatus("Please sign in or sign up to access inventory.", true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partsContainer.innerHTML = '<div><p class="text-xl text-center p-8 text-gray-500 font-bold">Please SIGN IN to view inventory.</p></div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Detach the old listener when user logs out
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (partsSnapshotUnsubscribe) { partsSnapshotUnsubscribe(); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Automatically open the sign-in modal if no one is logged in
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!getEl('modalAuth').classList.contains('hidden')) return; // Don't re-open if already open
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  openAuthModal('signIn');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  updateConnectionStatus("FATAL: Initialization failed. See console.", true);
Â  Â  Â  Â  Â  Â  console.error("Firebase Initialization/Startup Error:", error);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // --- APP STATE ---
Â  Â  let parts = [];
Â  Â  // Stores the Firestore document ID for editing/deleting
Â  Â  let editPartId = null;Â 
Â  Â  let page = 1;
Â  Â  let perPage = 10;
Â  Â  let categories = [];
Â  Â  let currentUser = null;Â 
Â  Â  let partsSnapshotUnsubscribe = null;
Â  Â  const partsContainer = document.getElementById('partsContainer');
Â  Â Â 
Â  Â  // Global function for custom confirmation (replaces window.confirm/alert)
Â  Â  let confirmResolver;
Â  Â Â 
Â  Â  function showConfirm(title, message, isAlert = false) {
Â  Â  Â  Â  return new Promise(resolve => {
Â  Â  Â  Â  Â  Â  confirmResolver = resolve;
Â  Â  Â  Â  Â  Â  getEl('confirmTitle').textContent = title;
Â  Â  Â  Â  Â  Â  getEl('confirmMessage').textContent = message;
Â  Â  Â  Â  Â  Â  // The CONFIRM button should be primary (red for deletion, yellow for standard)
Â  Â  Â  Â  Â  Â  const confirmBtn = getEl('btnConfirmAction');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Set CONFIRM button text/color based on alert status or title context
Â  Â  Â  Â  Â  Â  if (isAlert) {
Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.textContent = 'OK';
Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.classList.remove('bg-red-600');
Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.classList.add('neumo-btn-primary');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.textContent = 'CONFIRM';
Â  Â  Â  Â  Â  Â  Â  Â  confirmBtn.classList.add('bg-red-600');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  getEl('btnConfirmCancel').classList.toggle('hidden', isAlert);
Â  Â  Â  Â  Â  Â  getEl('modalConfirm').classList.remove('hidden');
Â  Â  Â  Â  });
Â  Â  }

Â  Â  getEl('btnConfirmCancel')?.addEventListener('click', () => {
Â  Â  Â  Â  getEl('modalConfirm').classList.add('hidden');
Â  Â  Â  Â  confirmResolver(false);
Â  Â  });

Â  Â  getEl('btnConfirmAction')?.addEventListener('click', () => {
Â  Â  Â  Â  getEl('modalConfirm').classList.add('hidden');
Â  Â  Â  Â  confirmResolver(true);
Â  Â  });

Â  Â  // --- FIREBASE PATH HELPERS ---
Â  Â  function getUserCollectionPath(collectionName) {
Â  Â  Â  Â  if (!currentUser || !currentUser.uid) {
Â  Â  Â  Â  Â  Â  // This should ideally not happen if called after successful sign-in
Â  Â  Â  Â  Â  Â  throw new Error("User not authenticated. Cannot access Firestore.");
Â  Â  Â  Â  }
Â  Â  Â  Â  // Private Data path: /users/{userId}/{collectionName}
Â  Â  Â  Â  return `users/${currentUser.uid}/${collectionName}`;
Â  Â  }

Â  Â  // Corrected to point to the secure, private 'parts' collection under the user's ID.
function getPartsCollectionRef() {
Â  Â  // This makes the collection path /users/{userId}/parts
Â  Â  return collection(db, getUserCollectionPath('parts'));Â 
}

Â  Â  function getCategoryDocRef() {
Â  Â  Â  Â  // This makes the document path /users/{userId}/categories/list
Â  Â  Â  Â  return doc(db, getUserCollectionPath('categories'), 'list');Â 
Â  Â  }

Â  Â  // --- CATEGORY MANAGEMENT LOGIC ---

Â  Â  async function loadCategories() {
Â  Â  Â  Â  if (!currentUser) return;
Â  Â  Â  Â  updateConnectionStatus("Loading categories...");
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const categoryDoc = await getDoc(getCategoryDocRef());
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (categoryDoc.exists() && categoryDoc.data().list) {
Â  Â  Â  Â  Â  Â  Â  Â  // Ensure array contains only valid, unique strings
Â  Â  Â  Â  Â  Â  Â  Â  categories = categoryDoc.data().list.filter(c => c && c.trim()).map(c => c.trim());
Â  Â  Â  Â  Â  Â  Â  Â  // Ensure 'Uncategorized' is always present
Â  Â  Â  Â  Â  Â  Â  Â  if (!categories.includes('Uncategorized')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  categories.unshift('Uncategorized');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  updateConnectionStatus(`Categories loaded (${categories.length}).`);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Initial load: Set defaults and save them
Â  Â  Â  Â  Â  Â  Â  Â  categories = ['Uncategorized', 'Fuel Injection', 'Brake System', 'Filters', 'Ignition'];
Â  Â  Â  Â  Â  Â  Â  Â  await saveCategories();
Â  Â  Â  Â  Â  Â  Â  Â  updateConnectionStatus("Default categories initialized.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  renderCategorySelects();
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â if (error.code === 'permission-denied') {
Â  Â  Â  Â  Â  Â  Â  Â  displaySecurityRulesError('Data load failed due to security rules');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  updateConnectionStatus("Error: Failed to load categories.", true);
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error loading categories:", error);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  async function saveCategories() {
Â  Â  Â  Â  if (!currentUser) return;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // Filter, trim, ensure uniqueness, and ensure 'Uncategorized' is first
Â  Â  Â  Â  Â  Â  let uniqueCategories = [...new Set(categories.map(c => c.trim()).filter(Boolean))];
Â  Â  Â  Â  Â  Â  uniqueCategories = uniqueCategories.filter(c => c !== 'Uncategorized');
Â  Â  Â  Â  Â  Â  uniqueCategories.unshift('Uncategorized');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  await setDoc(getCategoryDocRef(), { list: uniqueCategories });
Â  Â  Â  Â  Â  Â  categories = uniqueCategories;Â 
Â  Â  Â  Â  Â  Â  renderCategorySelects();Â 
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  updateConnectionStatus("Error saving categories.", true);
Â  Â  Â  Â  Â  Â  console.error("Error saving categories:", error);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  async function deleteCategory(categoryToDelete) {
Â  Â  Â  Â  if (categoryToDelete === 'Uncategorized') return showConfirm('Error', 'Cannot delete the "Uncategorized" category.', true);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const confirmed = await showConfirm('Confirm Deletion', `Are you sure you want to delete the category: ${categoryToDelete}? All parts currently assigned to this category will be moved to "Uncategorized".`);
Â  Â  Â  Â  if (!confirmed) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 1. Move all parts from the deleted category to 'Uncategorized'
Â  Â  Â  Â  const partsToUpdate = parts.filter(p => p.category === categoryToDelete);
Â  Â  Â  Â  const updateBatch = writeBatch(db);

Â  Â  Â  Â  partsToUpdate.forEach(part => {
Â  Â  Â  Â  Â  Â  // Correctly reference the part doc using the secure path
Â  Â  Â  Â  Â  Â  const partRef = doc(getPartsCollectionRef(), part.id);
Â  Â  Â  Â  Â  Â  updateBatch.update(partRef, { category: 'Uncategorized' });
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  await updateBatch.commit();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 2. Remove category and save updated list
Â  Â  Â  Â  Â  Â  categories = categories.filter(c => c !== categoryToDelete);
Â  Â  Â  Â  Â  Â  await saveCategories();
Â  Â  Â  Â  Â  Â  renderCategoryManagerList();
Â  Â  Â  Â  Â  Â  showConfirm('Category Deleted', `Category "${categoryToDelete}" deleted. ${partsToUpdate.length} parts reassigned to "Uncategorized".`, true);
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  showConfirm('Update Error', `Failed to delete category and reassign parts. Check console.`, true);
Â  Â  Â  Â  Â  Â  console.error("Category deletion error:", error);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderCategoryManagerList() {
Â  Â  Â  Â  const container = document.getElementById('categoryListContainer');
Â  Â  Â  Â  // Updated styling for categories list (sleek background/text)
Â  Â  Â  Â  container.innerHTML = categories.map((cat, index) => `
Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center p-3 bg-gray-200 rounded-lg shadow-inner">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-base font-semibold text-gray-800">${escapeHtml(cat)}</span>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.deleteCategoryHandler('${escapeHtml(cat)}')" class="text-red-600 hover:text-red-500 text-sm font-bold disabled:opacity-50" ${cat === 'Uncategorized' ? 'disabled' : ''}>REMOVE</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `).join('') || '<p class="text-center text-gray-500 text-sm italic">No categories defined.</p>';
Â  Â  }
Â  Â Â 
Â  Â  // Expose to window for inline HTML onclick to work
Â  Â  window.deleteCategoryHandler = deleteCategory;

Â  Â  function renderCategorySelects(selectedCategory = '') {
Â  Â  Â  Â  const selects = [
Â  Â  Â  Â  Â  Â  document.getElementById('inpCategory'),
Â  Â  Â  Â  Â  Â  document.getElementById('bulkCategoryInput'),
Â  Â  Â  Â  Â  Â  document.getElementById('categoryFilter')
Â  Â  Â  Â  ];
Â  Â  Â  Â Â 
Â  Â  Â  Â  const standardOptions = categories.map(cat =>Â 
Â  Â  Â  Â  Â  Â  `<option value="${escapeHtml(cat)}" ${cat === selectedCategory ? 'selected' : ''}>${escapeHtml(cat)}</option>`
Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  const filterOptions = [
Â  Â  Â  Â  Â  Â  `<option value="">ALL CATEGORIES</option>`,
Â  Â  Â  Â  Â  Â  ...categories.map(cat => `<option value="${escapeHtml(cat)}" ${cat === selectedCategory ? 'selected' : ''}>${escapeHtml(cat)}</option>`)
Â  Â  Â  Â  ].join('');

Â  Â  Â  Â  selects.forEach(select => {
Â  Â  Â  Â  Â  Â  if (select) {
Â  Â  Â  Â  Â  Â  Â  Â  if (select.id === 'categoryFilter') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  select.innerHTML = filterOptions;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Prevent setting onchange multiple times
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!select._initialized) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â select.addEventListener('change', () => { page = 1; renderCards(); });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â select._initialized = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  select.innerHTML = standardOptions;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }


Â  Â  // --- AUTHENTICATION & INITIALIZATION (Updated for Email/Password) ---
Â  Â Â 
Â  Â  let authMode = 'signIn'; // 'signIn' or 'signUp'

Â  Â  function openAuthModal(mode) {
Â  Â  Â  Â  authMode = mode;
Â  Â  Â  Â  getEl('authModalTitle').textContent = mode === 'signIn' ? 'Sign In to Your Account' : 'Create New Account';
Â  Â  Â  Â  getEl('btnAuthAction').textContent = mode === 'signIn' ? 'SIGN IN' : 'SIGN UP';
Â  Â  Â  Â  getEl('btnToggleAuthMode').textContent = mode === 'signIn' ? 'Need an account? Sign Up' : 'Have an account? Sign In';
Â  Â  Â  Â  getEl('authError').classList.add('hidden');
Â  Â  Â  Â  getEl('authEmail').value = '';
Â  Â  Â  Â  getEl('authPassword').value = '';
Â  Â  Â  Â  getEl('modalAuth').classList.remove('hidden');
Â  Â  }

Â  Â  async function handleAuthAction() {
Â  Â  Â  Â  const email = getEl('authEmail').value.trim();
Â  Â  Â  Â  const password = getEl('authPassword').value.trim();
Â  Â  Â  Â  const errorEl = getEl('authError');
Â  Â  Â  Â  errorEl.classList.add('hidden');

Â  Â  Â  Â  if (!email || !password) {
Â  Â  Â  Â  Â  Â  errorEl.textContent = 'Email and password are required.';
Â  Â  Â  Â  Â  Â  errorEl.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  getEl('btnAuthAction').disabled = true;
Â  Â  Â  Â  updateConnectionStatus(`Attempting ${authMode}...`);

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  if (authMode === 'signUp') {
Â  Â  Â  Â  Â  Â  Â  Â  await createUserWithEmailAndPassword(auth, email, password);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  await signInWithEmailAndPassword(auth, email, password);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Success - onAuthStateChanged handles the UI update
Â  Â  Â  Â  Â  Â  getEl('modalAuth').classList.add('hidden');
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  let msg = 'An unknown error occurred.';
Â  Â  Â  Â  Â  Â  if (error.code === 'auth/email-already-in-use') { msg = 'This email is already registered. Try signing in.'; }
Â  Â  Â  Â  Â  Â  else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') { msg = 'Invalid email or password.'; }
Â  Â  Â  Â  Â  Â  else if (error.code === 'auth/weak-password') { msg = 'Password should be at least 6 characters.'; }
Â  Â  Â  Â  Â  Â  else { console.error('Auth Error:', error); }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  errorEl.textContent = msg;
Â  Â  Â  Â  Â  Â  errorEl.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  updateConnectionStatus(`AUTH FAIL: ${error.code}`, true);
Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  getEl('btnAuthAction').disabled = false;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  getEl('btnOpenSignIn')?.addEventListener('click', () => openAuthModal('signIn'));
Â  Â  getEl('btnOpenSignUp')?.addEventListener('click', () => openAuthModal('signUp'));
Â  Â  getEl('btnCloseAuthModal')?.addEventListener('click', () => getEl('modalAuth').classList.add('hidden'));
Â  Â  getEl('btnAuthAction')?.addEventListener('click', handleAuthAction);
Â  Â Â 
Â  Â  getEl('btnToggleAuthMode')?.addEventListener('click', () => {
Â  Â  Â  Â  openAuthModal(authMode === 'signIn' ? 'signUp' : 'signIn');
Â  Â  });
Â  Â Â 
Â  Â  // Logout Handler
Â  Â  getEl('btnLogout')?.addEventListener('click', async () => {
Â  Â  Â  Â  const confirmed = await showConfirm('Confirm Logout', 'Are you sure you want to log out?', false);
Â  Â  Â  Â  if (!confirmed) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  await signOut(auth);
Â  Â  Â  Â  Â  Â  showConfirm('Logged Out', 'You have been successfully logged out.', true);
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  showConfirm('Logout Error', `Failed to log out: ${error.message}`, true);
Â  Â  Â  Â  Â  Â  console.error("Logout Error:", error);
Â  Â  Â  Â  }
Â  Â  });


Â  Â  // --- DATA HELPERS (Unchanged, but now using new secure paths) ---
Â  Â  function normalizeRecord(item) {
Â  Â  Â  Â  // Coerce to string/trim and ensure a default value
Â  Â  Â  Â  const zoren = (item.zoren ?? '').toString().trim();
Â  Â  Â  Â  let oem = item.oem ?? [];
Â  Â  Â  Â  if (typeof oem === 'string') {
Â  Â  Â  Â  Â  Â  // Safely split and trim comma-separated strings
Â  Â  Â  Â  Â  Â  oem = oem.split(',').map(s=>s.trim()).filter(Boolean);
Â  Â  Â  Â  } else if (!Array.isArray(oem)) {
Â  Â  Â  Â  Â  Â  // Handle if it was null/undefined or an unexpected type
Â  Â  Â  Â  Â  Â  oem = [];
Â  Â  Â  Â  }
Â  Â  Â  Â  const car_maker = (item.car_maker ?? '').toString().trim();
Â  Â  Â  Â  const applications = (item.applications ?? '').toString().trim();
Â  Â  Â  Â  const category = (item.category ?? 'Uncategorized').toString().trim();Â 

Â  Â  Â  Â  return { zoren, oem, car_maker, applications, category };
Â  Â  }
Â  Â Â 
Â  Â  function escapeHtml(s){ return s? String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;') : ''; }

Â  Â  /**
Â  Â  Â * Highlights all occurrences of the search query in the given text.
Â  Â  Â * @param {string} text The original string content.
Â  Â  Â * @param {string} query The search term.
Â  Â  Â * @returns {string} The HTML string with highlighted spans.
Â  Â  Â */
Â  Â  function highlightSearchTerm(text, query) {
Â  Â  Â  Â  if (!query) return escapeHtml(text);
Â  Â  Â  Â  const escapedText = escapeHtml(text);
Â  Â  Â  Â  // Create a RegExp that globally matches the query string (case-insensitive)
Â  Â  Â  Â  const regex = new RegExp(query, 'gi');
Â  Â  Â  Â  // Replace all matches with the matched term wrapped in a span
Â  Â  Â  Â  return escapedText.replace(regex, (match) => {
Â  Â  Â  Â  Â  Â  return `<span class="highlight">${match}</span>`;
Â  Â  Â  Â  });
Â  Â  }


Â  Â  // 1. READ (Load Data from Firestore)
Â  Â  function loadAndRenderParts() {
Â  Â  Â  Â  if (!currentUser || !db) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  partsContainer.innerHTML = '<div><p class="text-xl text-center p-8 text-gray-500 font-bold">LOADING INVENTORY...</p></div>';
Â  Â  Â  Â  updateConnectionStatus("Setting up real-time inventory listener...");
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (partsSnapshotUnsubscribe) {
Â  Â  Â  Â  Â  Â  partsSnapshotUnsubscribe(); // Detach previous listener
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Use onSnapshot for real-time updates
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  partsSnapshotUnsubscribe = onSnapshot(getPartsCollectionRef(), (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  parts = [];
Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach(doc => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const part = normalizeRecord(doc.data());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ensure the Firestore ID is saved with the part object
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  part.id = doc.id;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parts.push(part);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error normalizing part data:", doc.id, e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  updateConnectionStatus(`Inventory loaded successfully (${parts.length} parts).`);
Â  Â  Â  Â  Â  Â  Â  Â  renderCards();
Â  Â  Â  Â  Â  Â  Â  Â  if (parts.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partsContainer.innerHTML = '<div><p class="text-xl text-center p-8 text-gray-500 font-bold">NO PARTS FOUND. ADD NEW INVENTORY.</p></div>';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (error.code === 'permission-denied') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displaySecurityRulesError('Data stream failed due to security rules');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateConnectionStatus(`FATAL: Data stream interrupted. ${error.code}`, true);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error setting up snapshot listener: ", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partsContainer.innerHTML = `<div><p class="text-xl text-center p-8 text-red-600 font-bold">ERROR: ${error.message}</p></div>`;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Error accessing collection ref during onSnapshot setup:", e);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function renderCards() {Â 
Â  Â  Â  Â  if (!currentUser) { 
Â  Â  Â  Â  Â  Â  partsContainer.innerHTML = '<div><p class="text-xl text-center p-8 text-gray-500 font-bold">Please SIGN IN to view inventory.</p></div>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Get the current search query, converting it to lowercase for matching
Â  Â  Â  Â  const q = document.getElementById('searchInput')?.value.trim();
Â  Â  Â  Â  const qLower = q ? q.toLowerCase() : '';

Â  Â  Â  Â  const selectedCategoryFilter = document.getElementById('categoryFilter')?.value || '';
Â  Â  Â  Â  // Ensure perPage is set based on the current selection
Â  Â  Â  Â  perPage = parseInt(document.getElementById('perPage')?.value, 10) || 10;Â 

Â  Â  Â  Â  let filtered = parts.filter(item => {
Â  Â  Â  Â  Â  Â  // 1. Category Filter Check
Â  Â  Â  Â  Â  Â  if (selectedCategoryFilter && item.category !== selectedCategoryFilter) {
Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. Search Query Check
Â  Â  Â  Â  Â  Â  if (qLower) {
Â  Â  Â  Â  Â  Â  Â  Â  const searchString = `${item.zoren} ${item.oem.join(' ')} ${item.car_maker} ${item.applications} ${item.category}`.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  return searchString.includes(qLower);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  });

Â  Â  Â  Â  // Sort by ZOREN number (in-memory)
Â  Â  Â  Â  filtered.sort((a,b)=>a.zoren.localeCompare(b.zoren, undefined, {numeric:true}));

Â  Â  Â  Â  const total = filtered.length;
Â  Â  Â  Â  const pages = Math.max(1, Math.ceil(total/perPage));
Â  Â  Â  Â  // Reset page if necessary (e.g., filter/search changed the total count)
Â  Â  Â  Â  if (page > pages) page = pages;
Â  Â  Â  Â  page = Math.max(1, page); // Ensure page is at least 1
Â  Â  Â  Â Â 
Â  Â  Â  Â  const start = (page-1)*perPage;
Â  Â  Â  Â  const pageItems = filtered.slice(start, start+perPage);

Â  Â  Â  Â  partsContainer.innerHTML = '';
Â  Â  Â  Â  pageItems.forEach((item,i)=>{
Â  Â  Â  Â  Â  Â  // Highlight OEM tags before joining them
Â  Â  Â  Â  Â  Â  const oemTags = item.oem.map(oem =>Â 
Â  Â  Â  Â  Â  Â  Â  Â  `<span class="oem-tag">${highlightSearchTerm(oem, q)}</span>`
Â  Â  Â  Â  Â  Â  ).join('');

Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  card.className = 'part-card';
Â  Â  Â  Â  Â  Â  // Apply highlighting to all displayed fields
Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col justify-between card-header-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm font-extrabold text-gray-500 mb-2 uppercase">${highlightSearchTerm(item.category, q)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="card-zoren-no font-mono">${highlightSearchTerm(item.zoren, q)}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-actions flex gap-3 mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="editBtn text-gray-600 hover:text-gray-800" title="Edit" data-id="${escapeHtml(item.id)}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="delBtn text-red-600 hover:text-red-500" title="Delete" data-id="${escapeHtml(item.id)}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-details-grid text-lg font-medium">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm font-bold text-gray-500 uppercase">Car Maker:</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-gray-800">${highlightSearchTerm(item.car_maker, q)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm font-bold text-gray-500 uppercase">Applications:</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-gray-800">${highlightSearchTerm(item.applications, q)}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-sm font-bold text-gray-500 uppercase">OEM No. / Interchange:</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap pt-1 min-h-[30px]">${oemTags}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  partsContainer.appendChild(card);
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById('summaryText').textContent = `${total} RECORDS (${pageItems.length} VISIBLE)`;
Â  Â  Â  Â  document.getElementById('pageInfo').textContent = `PAGE ${page} / ${pages}`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  getEl('prevPage').disabled = page === 1;
Â  Â  Â  Â  getEl('nextPage').disabled = page === pages;

Â  Â  Â  Â  Array.from(document.getElementsByClassName('editBtn')).forEach(b=>b.addEventListener('click', onEdit));
Â  Â  Â  Â  Array.from(document.getElementsByClassName('delBtn')).forEach(b=>b.addEventListener('click', onDelete));
Â  Â  }

Â  Â  // Event Listeners (Pagination/Search)
Â  Â  getEl('prevPage')?.addEventListener('click', ()=>{ page=Math.max(1,page-1); renderCards(); });
Â  Â  getEl('nextPage')?.addEventListener('click', ()=>{ page++; renderCards(); });
Â  Â  getEl('searchInput')?.addEventListener('input', ()=>{ page=1; renderCards(); });
Â  Â  getEl('perPage')?.addEventListener('change', ()=>{ page=1; renderCards(); });
Â  Â Â 
Â  Â  // 2. CREATE / UPDATE (Save to Firestore)
Â  Â  const modalAddEdit = getEl('modalAddEdit');
Â  Â  getEl('btnAdd')?.addEventListener('click', ()=>{ openAddModal(); });
Â  Â  getEl('btnCancelModal')?.addEventListener('click', ()=>modalAddEdit?.classList.add('hidden'));

Â  Â  getEl('btnSaveModal')?.addEventListener('click', async ()=>{
Â  Â  Â  Â  if (!currentUser) { showConfirm('Auth Error', 'Authentication is required.', true); return; }

Â  Â  Â  Â  const zoren = getEl('inpZoren')?.value.trim();
Â  Â  Â  Â  const category = getEl('inpCategory')?.value.trim();
Â  Â  Â  Â  const car_maker=getEl('inpCarMaker')?.value.trim();
Â  Â  Â  Â  const applications=getEl('inpApplications')?.value.trim();

Â  Â  Â  Â  // Helper function to clear all errors
Â  Â  Â  Â  const clearErrors = () => {
Â  Â  Â  Â  Â  Â  getEl('zorenError')?.classList.add('hidden');
Â  Â  Â  Â  Â  Â  getEl('carMakerError')?.classList.add('hidden');
Â  Â  Â  Â  Â  Â  getEl('applicationsError')?.classList.add('hidden');
Â  Â  Â  Â  };

Â  Â  Â  Â  clearErrors();

Â  Â  Â  Â  // --- DATA VALIDATION ---
Â  Â  Â  Â  let isValid = true;
Â  Â  Â  Â  // Regex allows alphanumeric characters and hyphens only
Â  Â  Â  Â  const zorenRegex = /^[a-zA-Z0-9-]+$/;Â 

Â  Â  Â  Â  if(!zoren || zoren.length < 4 || !zorenRegex.test(zoren)){Â 
Â  Â  Â  Â  Â  Â  getEl('zorenError').textContent = 'ZOREN No. is required (min 4 chars) and must be alphanumeric/hyphen.';
Â  Â  Â  Â  Â  Â  getEl('zorenError').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  }
Â  Â  Â  Â  if(!category){Â 
Â  Â  Â  Â  Â  Â  showConfirm('Error', 'Category is required', true);
Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  }
Â  Â  Â  Â  if(!car_maker){Â 
Â  Â  Â  Â  Â  Â  getEl('carMakerError').textContent = 'Car Maker is required.';
Â  Â  Â  Â  Â  Â  getEl('carMakerError').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  }
Â  Â  Â  Â  if(!applications){Â 
Â  Â  Â  Â  Â  Â  getEl('applicationsError').textContent = 'Applications field is required.';
Â  Â  Â  Â  Â  Â  getEl('applicationsError').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  isValid = false;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (!isValid) return;
Â  Â  Â  Â  // -----------------------

Â  Â  Â  Â  let oemRaw=getEl('inpOem')?.value.trim();
Â  Â  Â  Â  let oemArr=[];
Â  Â  Â  Â  if(oemRaw){Â 
Â  Â  Â  Â  Â  Â  // Only split by comma; assume user enters CSV format
Â  Â  Â  Â  Â  Â  oemArr=oemRaw.split(',').map(s=>s.trim()).filter(Boolean);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  const dataToSave = { zoren, oem: oemArr, car_maker, applications, category };

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  if (editPartId) {
Â  Â  Â  Â  Â  Â  Â  Â  // Update existing document using its stored ID
Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(doc(getPartsCollectionRef(), editPartId), dataToSave);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Add new document
Â  Â  Â  Â  Â  Â  Â  Â  await addDoc(getPartsCollectionRef(), dataToSave);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  modalAddEdit.classList.add('hidden');
Â  Â  Â  Â  Â  Â  // loadAndRenderParts() will be triggered by onSnapshot automatically
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  showConfirm('Error Saving Data', "Error saving data. Check console for details.", true);
Â  Â  Â  Â  Â  Â  console.error("Error saving document: ", error);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  // Updated to pass the Part object and its Firestore ID.
Â  Â  function openAddModal(item=null, partId=null){Â 
Â  Â  Â  Â  if (!currentUser) { 
Â  Â  Â  Â  Â  Â  showConfirm('Access Denied', 'Please sign in to add or edit parts.', true); 
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  editPartId = partId; // Store the ID
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Clear errors on modal open
Â  Â  Â  Â  getEl('zorenError')?.classList.add('hidden');
Â  Â  Â  Â  getEl('carMakerError')?.classList.add('hidden');
Â  Â  Â  Â  getEl('applicationsError')?.classList.add('hidden');

Â  Â  Â  Â  getEl('modalTitle').textContent=item?'EDIT PART':'ADD PART';
Â  Â  Â  Â  getEl('inpZoren').value=item?item.zoren:'';
Â  Â  Â  Â  // Join the array for display in the input field
Â  Â  Â  Â  getEl('inpOem').value=item?item.oem.join(', '):'';
Â  Â  Â  Â  getEl('inpCarMaker').value=item?item.car_maker:'';
Â  Â  Â  Â  getEl('inpApplications').value=item?item.applications:'';
Â  Â  Â  Â  // Render selects and pre-select the category if item exists
Â  Â  Â  Â  renderCategorySelects(item ? item.category : categories[0]);Â 
Â  Â  Â  Â  modalAddEdit.classList.remove('hidden');
Â  Â  }

Â  Â  // --- NEW RELIABLE onEdit function ---
Â  Â  function onEdit(e){Â 
Â  Â  Â  Â  const partId = e.currentTarget.getAttribute('data-id');
Â  Â  Â  Â  if (!partId) return;Â 

Â  Â  Â  Â  // Find the part object using the guaranteed Firestore ID
Â  Â  Â  Â  const partToEdit = parts.find(p => p.id === partId);Â 

Â  Â  Â  Â  if (!partToEdit) {
Â  Â  Â  Â  Â  Â  showConfirm('Error', 'Could not find part to edit.', true);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Pass the actual part object and its Firestore ID
Â  Â  Â  Â  openAddModal(partToEdit, partToEdit.id);
Â  Â  }
Â  Â Â 
Â  Â  // 3. DELETE (Delete from Firestore)
Â  Â  // --- NEW RELIABLE onDelete function ---
Â  Â  async function onDelete(e){Â 
Â  Â  Â  Â  if (!currentUser) { showConfirm('Auth Error', 'Authentication is required.', true); return; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Get the guaranteed Firestore ID
Â  Â  Â  Â  const partId = e.currentTarget.getAttribute('data-id');Â 
Â  Â  Â  Â  if (!partId) return;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Find the part object using the ID
Â  Â  Â  Â  const partToDelete = parts.find(p => p.id === partId);Â 

Â  Â  Â  Â  if (!partToDelete || !partToDelete.id) {
Â  Â  Â  Â  Â  Â  showConfirm('Error', 'Could not identify part for deletion.', true);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const confirmed = await showConfirm('Confirm Deletion', `Permanently delete ZOREN No. ${partToDelete.zoren}? This action cannot be undone.`);
Â  Â  Â  Â  if (!confirmed) return;

Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // Use the unique Firestore ID (partToDelete.id) for deletion
Â  Â  Â  Â  Â  Â  await deleteDoc(doc(getPartsCollectionRef(), partToDelete.id));
Â  Â  Â  Â  Â  Â  // loadAndRenderParts() will be triggered by onSnapshot automatically
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  showConfirm('Error Deleting', "Error deleting record. Check console for details.", true);
Â  Â  Â  Â  Â  Â  console.error("Error deleting document: ", error);
Â  Â  Â  Â  }
Â  Â  }Â 

Â  Â  // --- BULK UPLOAD LOGIC ---
Â  Â  // Bulk Modal Controls
Â  Â  const modalBulk=getEl('modalBulk');
Â  Â  getEl('btnBulk')?.addEventListener('click',()=>{
Â  Â  Â  Â  if (!currentUser) { 
Â  Â  Â  Â  Â  Â  showConfirm('Access Denied', 'Please sign in to perform bulk operations.', true); 
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  modalBulk.classList.remove('hidden');Â 
Â  Â  Â  Â  getEl('bulkCategorySelector').classList.remove('hidden');
Â  Â  Â  Â  renderCategorySelects();
Â  Â  });
Â  Â  getEl('btnCloseBulk')?.addEventListener('click',()=>modalBulk.classList.add('hidden'));
Â  Â Â 
Â  Â  getEl('bulkFileInput')?.addEventListener('change',ev=>{
Â  Â  Â  Â  const f=ev.target.files[0];Â 
Â  Â  Â  Â  if(!f) return;Â 
Â  Â  Â  Â  const reader=new FileReader();
Â  Â  Â  Â  reader.onload=e=>getEl('bulkTextarea').value=e.target.result;Â 
Â  Â  Â  Â  showConfirm('File Loaded', "JSON content loaded into the textarea. Click 'Load & Merge' or 'Replace All' to proceed.", true);
Â  Â  });
Â  Â Â 
Â  Â  // Centralized Batch Upload Function
Â  Â  async function executeBatchUpload(records, replaceMode) {
Â  Â  Â  Â  if (!currentUser) { throw new Error('Authentication is required.'); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Basic Bulk Validation: Check if required fields exist in all records
Â  Â  Â  Â  const invalidRecords = records.filter(r => !r.zoren || r.zoren.length < 4 || !r.car_maker || !r.applications);
Â  Â  Â  Â  if (invalidRecords.length > 0) {
Â  Â  Â  Â  Â  Â  showConfirm('Validation Failed', `Bulk upload failed: ${invalidRecords.length} records are missing required fields (Zoren No. (min 4), Car Maker, or Applications). Please fix and retry.`, true);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const batch = writeBatch(db);

Â  Â  Â  Â  if (replaceMode) {
Â  Â  Â  Â  Â  Â  // Delete all existing documents in the collection
Â  Â  Â  Â  Â  Â  const existingSnapshot = await getDocs(getPartsCollectionRef());
Â  Â  Â  Â  Â  Â  existingSnapshot.forEach(doc => { batch.delete(doc.ref); });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Add new records
Â  Â  Â  Â  records.forEach(record => {
Â  Â  Â  Â  Â  Â  const newDocRef = doc(getPartsCollectionRef());
Â  Â  Â  Â  Â  Â  // Filter out 'id' if it somehow made its way in
Â  Â  Â  Â  Â  Â  const { id, ...data } = record;Â 
Â  Â  Â  Â  Â  Â  batch.set(newDocRef, data);
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  await batch.commit();
Â  Â  Â  Â Â 
Â  Â  Â  Â  getEl('bulkTextarea').value='';Â 
Â  Â  Â  Â  modalBulk.classList.add('hidden');Â 
Â  Â  Â  Â  // onSnapshot handles the re-render
Â  Â  Â  Â  return records.length;
Â  Â  }
Â  Â Â 
Â  Â  async function handleBulkUpload(replaceMode) {
Â  Â  Â  Â  const txt=getEl('bulkTextarea')?.value.trim();Â 
Â  Â  Â  Â  if(!txt){ showConfirm('Input Empty', 'Bulk textarea is empty.', true); return; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(replaceMode) {
Â  Â  Â  Â  Â  Â  const confirmed = await showConfirm('DANGER: REPLACE ALL', 'WARNING: Are you sure you want to delete ALL your existing data and replace it? This is PERMANENT.', false);
Â  Â  Â  Â  Â  Â  if (!confirmed) return;
Â  Â  Â  Â  }

Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  const parsed=JSON.parse(txt);Â 
Â  Â  Â  Â  Â  Â  if(!Array.isArray(parsed)){ showConfirm('Invalid Format', 'JSON must be a root array of part objects.', true); return; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let recordsToImport = parsed.map(normalizeRecord);
Â  Â  Â  Â  Â  Â  const selectedCategory = getEl('bulkCategoryInput').value.trim();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Assign the selected category to any record that didn't have one (category is 'Uncategorized' by default if not set)
Â  Â  Â  Â  Â  Â  const finalRecords = recordsToImport.map(r => ({
Â  Â  Â  Â  Â  Â  Â  Â  ...r,
Â  Â  Â  Â  Â  Â  Â  Â  category: r.category === 'Uncategorized' ? selectedCategory : r.category
Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  const count = await executeBatchUpload(finalRecords, replaceMode);
Â  Â  Â  Â  Â  Â  if (count) {
Â  Â  Â  Â  Â  Â  Â  Â  const message = replaceModeÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `SUCCESS: Replaced all records. Total: ${count}.`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `SUCCESS: Merged ${count} new records.`;
Â  Â  Â  Â  Â  Â  Â  Â  showConfirm('Upload Complete', message, true);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  } catch(err){Â 
Â  Â  Â  Â  Â  Â  showConfirm('Processing Error', 'Error during bulk operation. Check console for JSON parsing details.', true);Â 
Â  Â  Â  Â  Â  Â  console.error("Bulk upload error:", err);Â 
Â  Â  Â  Â  }
Â  Â  }

Â  Â  getEl('btnLoadBulk')?.addEventListener('click', () => handleBulkUpload(false)); // Merge
Â  Â  getEl('btnReplaceBulk')?.addEventListener('click', () => handleBulkUpload(true)); // Replace

Â  Â  // --- CATEGORY MANAGER MODAL LISTENERS (Unchanged, now using secure paths) ---
Â  Â  const modalCategoryManager = getEl('modalCategoryManager');
Â  Â  getEl('btnManageCategories')?.addEventListener('click', () => {
Â  Â  Â  Â  renderCategoryManagerList();
Â  Â  Â  Â  modalCategoryManager?.classList.remove('hidden');
Â  Â  });

Â  Â  getEl('btnCloseCategoryManager')?.addEventListener('click', () => {
Â  Â  Â  Â  modalCategoryManager?.classList.add('hidden');
Â  Â  });

Â  Â  // --- Corrected btnAddCategory for Persistence ---
Â  Â  getEl('btnAddCategory')?.addEventListener('click', async () => {
Â  Â  Â  Â  const newCat = getEl('inpNewCategory')?.value.trim();
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!newCat) {
Â  Â  Â  Â  Â  Â  Â showConfirm('Error', 'Category name cannot be empty.', true);
Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (categories.includes(newCat)) {
Â  Â  Â  Â  Â  Â  showConfirm('Error', 'Category already exists.', true);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // 1. Add the new category to the local array
Â  Â  Â  Â  categories.push(newCat);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 2. Clear the input field
Â  Â  Â  Â  getEl('inpNewCategory').value = '';
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 3. Save the updated list to Firestore (calls saveCategories and re-renders selects)
Â  Â  Â  Â  await saveCategories();Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // 4. Re-render the list in the Category Manager modal
Â  Â  Â  Â  renderCategoryManagerList();
Â  Â  Â  Â Â 
Â  Â  Â  Â  showConfirm('Category Added', `Category "${newCat}" has been added.`, true);
Â  Â  });

Â  Â  // --- EXPORT LOGIC (Unchanged) ---

Â  Â  function createDownloadLink(data, filename, mimeType) {
Â  Â  Â  Â  const blob = new Blob([data], { type: mimeType });
Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  const a = document.createElement('a');
Â  Â  Â  Â  a.href = url;
Â  Â  Â  Â  a.download = filename;
Â  Â  Â  Â  document.body.appendChild(a);
Â  Â  Â  Â  a.click();
Â  Â  Â  Â  document.body.removeChild(a);
Â  Â  Â  Â  URL.revokeObjectURL(url);
Â  Â  }

Â  Â  getEl('btnDownloadJson')?.addEventListener('click', () => {
Â  Â  Â  Â  const dataToExport = parts.map(p => ({
Â  Â  Â  Â  Â  Â  zoren: p.zoren,
Â  Â  Â  Â  Â  Â  car_maker: p.car_maker,
Â  Â  Â  Â  Â  Â  applications: p.applications,
Â  Â  Â  Â  Â  Â  oem: p.oem,
Â  Â  Â  Â  Â  Â  category: p.category
Â  Â  Â  Â  }));
Â  Â  Â  Â  const json = JSON.stringify(dataToExport, null, 2);
Â  Â  Â  Â  createDownloadLink(json, `inventory_export_${new Date().toISOString().slice(0, 10)}.json`, 'application/json');
Â  Â  Â  Â  showConfirm('Export Complete', 'Inventory data successfully exported as JSON.', true);
Â  Â  });

Â  Â  getEl('btnExportCsv')?.addEventListener('click', () => {
Â  Â  Â  Â  if (parts.length === 0) {
Â  Â  Â  Â  Â  Â  showConfirm('Export Error', 'No data to export.', true);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const headers = ["ZOREN No.", "Car Maker", "Applications", "OEM No.", "Category"];
Â  Â  Â  Â  const rows = parts.map(p => [
Â  Â  Â  Â  Â  Â  p.zoren,
Â  Â  Â  Â  Â  Â  p.car_maker,
Â  Â  Â  Â  Â  Â  p.applications,
Â  Â  Â  Â  Â  Â  p.oem.join('; '), // Use semicolon to separate multiple OEM numbers
Â  Â  Â  Â  Â  Â  p.category
Â  Â  Â  Â  ]);

Â  Â  Â  Â  const csvContent = [
Â  Â  Â  Â  Â  Â  headers.map(h => `"${h}"`).join(','),
Â  Â  Â  Â  Â  Â  ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
Â  Â  Â  Â  ].join('\n');

Â  Â  Â  Â  createDownloadLink(csvContent, `inventory_export_${new Date().toISOString().slice(0, 10)}.csv`, 'text/csv');
Â  Â  Â  Â  showConfirm('Export Complete', 'Inventory data successfully exported as CSV.', true);
Â  Â  });

Â  Â  // --- Start App Initialization ---
Â  Â  // Wait for the DOM content to be fully loaded before trying to initialize Firebase
Â  Â  document.addEventListener('DOMContentLoaded', initApp);
Â  Â  // --------------------------------
</script>

</body>
</html>
